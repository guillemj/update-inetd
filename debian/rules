#!/usr/bin/make -f
# Sample debian.rules file - for GNU Hello (1.3).
# Copyright 1994,1995 by Ian Jackson.
# I hereby give you perpetual unlimited permission to copy,
# modify and relicense this file, provided that you do not remove
# my name from the file itself.  (I assert my moral right of
# paternity under the Copyright, Designs and Patents Act 1988.)
# This file may have to be extensively modified

package=netbase

SUBDIRS  = netkit-base-0.10 net-tools-1.32-alpha tcp_wrappers_7.6 \
	   portmap_5 ipfwadm-2.3.0 ipautofw-960628

export BASEDIR=$(shell pwd)/debian/tmp

export TCPD_DIR = $(shell find `pwd` -maxdepth 1 -type d -name tcp_wrapper\* 2>/dev/null)
ifeq ($(TCPD_DIR),)
export TCPD_DIR=/usr/lib
endif


build:
	$(checkdir)
	@for i in $(SUBDIRS); do \
	  ( cd ./$$i && echo -e "\nMaking all in \`$$i':\n" && make ) || exit 1; \
	done
	touch build

clean:
	$(checkdir)
	-rm -f build
	@for i in $(SUBDIRS); do \
	  ( cd ./$$i && echo -e "\nMaking clean in \`$$i':\n" && make clean ) || exit 1; \
	done
	-rm -rf debian/tmp debian/files* core debian/substvars

binary-indep:	checkroot build
	$(checkdir)
# There are no architecture-independent files to be uploaded
# generated by this package.  If there were any they would be
# made here.

binary-arch:	checkroot build
	$(checkdir)
	-rm -rf debian/tmp
	install -d debian/tmp
	cd debian/tmp;install -d `cat ../dirs`
	@for i in $(SUBDIRS); do \
	  ( cd ./$$i && echo -e "\nMaking install in \`$$i':\n" && \
	    make install ) || exit 1; \
	done
	install -o root -g root -m 0755 debian/netbase.init.d `pwd`/debian/tmp/etc/init.d/netbase
	install -o root -g root -m 0644 etc-gateways `pwd`/debian/tmp/etc/gateways
	install -o root -g root -m 0644 etc-hosts.allow `pwd`/debian/tmp/etc/hosts.allow
	install -o root -g root -m 0644 etc-hosts.deny `pwd`/debian/tmp/etc/hosts.deny
	install -o root -g root -m 0644 etc-protocols `pwd`/debian/tmp/etc/protocols
	install -o root -g root -m 0644 etc-rpc `pwd`/debian/tmp/etc/rpc
	install -o root -g root -m 0644 etc-services `pwd`/debian/tmp/etc/services
	install -o root -g root -m 0644 DebianNet.pm `pwd`/debian/tmp/usr/lib/perl5
	install -o root -g root -m 0644 DebianNet.3pm `pwd`/debian/tmp/usr/man/man3
	install -o root -g root -m 0755 update-inetd `pwd`/debian/tmp/usr/sbin
	install -o root -g root -m 0644 update-inetd.8 `pwd`/debian/tmp/usr/man/man8
	install -o root -g root -m 0644 resolv+.8 `pwd`/debian/tmp/usr/man/man8
	install -o root -g root -m 0644 inetd.conf.5 `pwd`/debian/tmp/usr/man/man5
# Must have debmake installed for this to work. Otherwise please copy
# /usr/bin/debstd into the debian directory and change debstd to debian/debstd
	debstd -m
	dpkg-gencontrol
	dpkg --build debian/tmp ..

define checkdir
	test -f debian/rules
endef

# Below here is fairly generic really

binary:		binary-indep binary-arch

source diff:
	@echo >&2 'source and diff are obsolete - use dpkg-source -b'; false

checkroot:
	$(checkdir)
	test root = "`whoami`"

.PHONY: binary binary-arch binary-indep clean checkroot
